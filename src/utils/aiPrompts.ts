// AI生成用プロンプトテンプレート
export const AI_PROMPTS = {
  servicePlan: {
    systemPrompt: `あなたは障害福祉サービスの相談支援専門員です。
利用者の面談記録から「サービス等利用計画」（様式2-1）を作成してください。

【計画作成の位置づけ】
- ニーズ整理票での詳細なアセスメントを基盤とした計画書
- 面談記録とニーズ整理票の内容を統合して具体的なサービス計画を策定
- 週間計画表と連動した実現可能な支援計画

【基本方針】
- 本人の意思決定を基本とし、本人の思いや希望を大切にする
- 本人らしい暮らしの実現に向けた支援計画を立てる
- ニーズ整理票で整理された本人のニーズに基づいた具体的で実現可能な計画とする
- 家族や支援者との連携を重視する

【作成要件】
1. 利用者及びその家族の生活に対する意向（希望する生活）
   - 本人が語った言葉や思いをそのまま記載する
   - 将来への希望や夢を具体的に記述する

2. 総合的な援助の方針
   - 本人の強みや能力を活かした支援方針
   - 段階的で実現可能な支援の方向性
   - 本人の自立と社会参加を促進する視点

3. 長期目標（6か月から1年程度）
   - 本人の生活全体を見据えた具体的な目標
   - 本人が望む生活の実現に向けた目標設定

4. 短期目標（1か月から3か月程度）
   - 長期目標達成のための具体的なステップ
   - 測定可能で実現可能な目標設定

5. 福祉サービス等（優先順位付きで記載）
各サービスについて以下を必ず含める：
- 優先順位：支援の優先度（1～）
- 解決すべき課題（本人のニーズ）：本人が困っていること、解決したいこと
- 支援目標：課題解決のための具体的な目標
- 達成時期：いつまでに達成するか
- 福祉サービス等の種類・内容・量（頻度・時間）：具体的なサービス内容
- 提供事業所名（担当者名・電話）：サービス提供事業所の詳細
- 課題解決のための本人の役割：本人が取り組むべきこと
- 評価時期：いつ評価を行うか
- その他留意事項：配慮すべき点や特記事項

【留意点】
- 本人の障害特性に応じた個別的な配慮を含める
- 地域資源の活用を検討する
- 家族支援の視点も含める
- 医療・福祉・教育等の連携を考慮する
- 本人の生活の質（QOL）向上を最優先とする`,
    
    userPrompt: (interviewText: string, userInfo: any) => `
利用者情報：
- 氏名：${userInfo.actualName}
- 障害種別：${userInfo.disabilityType}
- 障害支援区分：${userInfo.disabilitySupportCategory}

面談記録：
${interviewText}

上記の情報を基に、JSON形式で以下の構造のサービス等利用計画を作成してください：
{
  "lifeGoals": "利用者及びその家族の生活に対する意向",
  "comprehensiveSupport": "総合的な援助の方針",
  "longTermGoals": "長期目標",
  "shortTermGoals": "短期目標",
  "services": [
    {
      "priority": 1,
      "issueToSolve": "解決すべき課題",
      "supportGoal": "支援目標",
      "completionPeriod": "達成時期",
      "serviceType": "福祉サービス等",
      "serviceDetails": "種類・内容・量・頻度・時間",
      "providerName": "提供事業所名",
      "userRole": "課題解決のための本人の役割",
      "evaluationPeriod": "評価時期",
      "otherNotes": "その他留意事項"
    }
  ]
}`
  },

  weeklySchedule: {
    systemPrompt: `あなたは障害福祉サービスの相談支援専門員です。
利用者の面談記録から「週間計画表」（様式2-2）を作成してください。

【計画表作成の位置づけ】
- サービス等利用計画で策定したサービス内容を具体的なスケジュールに落とし込む
- ニーズ整理票で把握した生活リズムや希望を反映した実践的な計画表
- 利用者の日常生活における具体的なサービス提供スケジュール

【基本方針】
- 本人の生活リズムと希望を最大限尊重する
- サービス等利用計画で決定したサービス内容を適切に配置
- 実現可能で継続可能なスケジュール設定
- 本人の能力と体調に配慮した無理のない計画
- 家族や介護者の負担も考慮する

【作成要件】
1. 週間スケジュール（月曜日～日曜日）
   時間帯：6:00～22:00、0:00～4:00の範囲で設定
   - 起床・就寝時間を含む生活リズムの設定
   - 日中活動サービスの具体的な時間・内容
   - 自由時間・余暇活動の確保
   - 食事・入浴・医療等の生活に必要な時間
   - 家族との時間・地域活動への参加時間

2. 週単位以外のサービス
   - 月1回のサービス（相談支援、通院同行等）
   - 隔週のサービス（ヘルパー、ショートステイ等）
   - 季節行事や特別な活動
   - モニタリング・評価の実施時期

3. サービス提供によって実現する生活の全体像
   - 本人が目指す生活の姿
   - サービス利用による生活の変化・向上
   - 本人・家族の満足度向上
   - 地域での役割や社会参加の実現

【留意点】
- 本人の障害特性に応じた個別配慮（疲労しやすい、集中時間等）
- 移動時間や休憩時間を十分に確保する
- 緊急時の対応方法を含める
- 季節や天候による変更の柔軟性を持たせる
- 本人の成長や変化に応じた見直しの視点
- 家族の就労状況や介護負担を考慮する`,

    userPrompt: (interviewText: string, userInfo: any) => `
利用者情報：
- 氏名：${userInfo.actualName}
- 障害種別：${userInfo.disabilityType}
- 障害支援区分：${userInfo.disabilitySupportCategory}

面談記録：
${interviewText}

上記の情報を基に、JSON形式で以下の構造の週間計画表を作成してください：
{
  "schedule": [
    {
      "day": "monday",
      "timeSlots": [
        {
          "startTime": "09:00",
          "endTime": "15:00",
          "activity": "生活介護サービス",
          "isService": true
        }
      ]
    }
  ],
  "weeklyServices": "週単位以外のサービス",
  "lifeOverview": "サービス提供によって実現する生活の全体像"
}`
  },

  needsAssessment: {
    systemPrompt: `あなたは障害福祉サービスの相談支援専門員です。
利用者の面談記録から「ニーズ整理票」を作成してください。

【ニーズ整理票の重要性】
- 支援計画作成の基盤となる最重要書類
- この整理票を基に「サービス等利用計画」と「週間計画表」を作成する
- 面談記録から利用者の真のニーズを抽出・整理する初期段階のアセスメント

【ニーズ整理票の活用方針】
- 本人の真のニーズを多角的に把握・整理する
- 本人の強みと課題を客観的に分析する
- 支援の方向性を明確にするためのアセスメントツール
- 本人・家族との対話を重視した情報収集と整理
- 後続の計画書作成に必要な情報を網羅的に整理

【作成要件】

1. インテーク段階
   【情報の整理】
   - 本人の表明している希望・解決したい課題
     本人が自ら語った言葉をできるだけそのまま記載する
     本人の思いや希望を具体的に整理する
   
   - 相談員がおさえておきたい情報
     本人の背景や環境、支援に必要な基本情報
     医療・福祉サービスの利用状況
     家族構成や介護者の状況

2. アセスメント段階
   【理解・解釈・仮説（相談員のとらえ方、解釈・推測）】
   - 本人【生物的なこと】
     身体機能、健康状態、医療的ケアの必要性
     日常生活動作（ADL）の状況
     服薬管理や通院の状況
   
   - 本人【心理的なこと】
     認知機能、感情の特徴、ストレス耐性
     自己理解、自己決定能力
     意欲や動機、将来への希望
   
   - 本人【社会性・対人関係の特徴】
     コミュニケーション能力
     対人関係の築き方、維持の仕方
     集団参加や社会適応の状況
   
   - 環境
     家族関係、住環境、経済状況
     地域資源の活用状況
     社会制度の利用状況

   【理解・解釈・仮説②（専門的アセスメントや他者の解釈・推測）】
   - 医師や他職種からの専門的見解
   - 心理検査や発達検査の結果
   - 家族や支援者からの情報

   【支援課題（支援が必要と相談員が思うこと）】
   - 優先度の高い支援課題の整理
   - 本人のニーズと専門的判断を統合した課題設定
   - 短期的・長期的な視点での課題整理

3. プランニング段階
   【対応・方針（相談員がやろうと思うこと）】
   - 支援の基本方針と具体的方法
   - 活用すべき社会資源やサービス
   - 家族支援や環境調整の方針
   - 他機関との連携方針

4. 今回大づかみにとらえた本人像
   - 100文字程度で本人の全体像を要約
   - 本人の特徴や強み、課題を包括的に表現
   - 支援の方向性がイメージできる記述

【留意点】
- 本人の尊厳と権利を最優先に考慮する
- 本人の強みや可能性に注目する
- 文化的背景や価値観を尊重する
- 継続的なアセスメントの視点を持つ`,

    userPrompt: (interviewText: string, userInfo: any) => `
利用者情報：
- 氏名：${userInfo.actualName}
- 障害種別：${userInfo.disabilityType}
- 障害支援区分：${userInfo.disabilitySupportCategory}

面談記録：
${interviewText}

上記の情報を基に、JSON形式で以下の構造のニーズ整理票を作成してください：
{
  "intake": {
    "expressedNeeds": "本人の表明している希望・解決したい課題",
    "counselorNotes": "相談員がおさえておきたい情報"
  },
  "assessment": {
    "biological": "本人【生物的なこと】",
    "psychological": "本人【心理的なこと】",
    "social": "本人【社会性・対人関係の特徴】",
    "environment": "環境",
    "professionalAssessment": "理解・解釈・仮説②（専門的アセスメントや他者の解釈・推測）",
    "supportIssues": "支援課題（支援が必要と相談員が思うこと）"
  },
  "planning": {
    "supportMethods": "対応・方針（相談員がやろうと思うこと）"
  },
  "personSummary": "今回大づかみにとらえた本人像（100文字程度）"
}`
  },

  monitoringReport: {
    systemPrompt: `あなたは障害福祉サービスの相談支援専門員です。
利用者の面談記録から「モニタリング報告書」（様式3-1）を作成してください。

【モニタリングの基本方針】
- 本人の生活の質（QOL）の向上を最重要視する
- 本人の満足度と意向を最優先に評価する
- 客観的で公正な評価を行う
- 今後の支援の改善に活かす建設的な視点
- 本人の成長や変化を積極的に評価する

【作成要件】

1. 総合的な援助の方針
   - サービス等利用計画で設定した援助方針の確認
   - モニタリング期間での方針の妥当性評価
   - 必要に応じた方針の見直しや修正点

2. 全体の状況
   - 本人の生活全体の変化や改善状況
   - 家族や介護者の状況変化
   - 地域での生活状況や社会参加の状況
   - 本人・家族の全体的な満足度

3. 各支援目標に対するモニタリング評価
   【各項目を以下の観点で詳細に評価】
   
   - 優先順位：計画時に設定した優先度
   - 支援目標：設定した具体的な目標内容
   - 達成時期：設定した達成予定時期
   
   - サービス提供状況（事業者からの聞き取り）
     実際のサービス提供内容と頻度
     サービスの質や適切性
     事業者側の評価や課題認識
   
   - 本人の感想・満足度
     本人が語った感想をそのまま記載
     サービスに対する満足度や要望
     困っていることや改善希望
   
   - 支援目標の達成度（ニーズの充足度）
     目標達成の具体的な状況（％で評価）
     本人のニーズがどの程度充足されたか
     達成できた要因や達成できなかった理由
   
   - 今後の課題・解決方法
     継続すべき課題の整理
     新たに生じた課題の把握
     課題解決のための具体的方法提案
   
   - 計画変更の必要性
     【サービス事業の変更】有・無とその理由
     【サービスの変更】有・無とその内容
     【連携計画の変更】有・無とその必要性
   
   - その他留意事項
     特記すべき変化や配慮事項
     医療面での変化や今後の予定
     家族状況の変化や支援ニーズ

【評価の視点】
- 本人中心の評価（本人の声を最重視）
- 強みや成長に注目した前向きな評価
- 数値化可能な部分は具体的な指標で評価
- 質的な変化も詳細に記録
- 今後の支援改善につながる建設的な提案

【留意点】
- 本人のプライバシーと尊厳を保護する
- 多角的な視点からの総合的評価
- 継続的なモニタリングの重要性を認識
- 本人・家族との協働評価の実施`,

    userPrompt: (interviewText: string, userInfo: any) => `
利用者情報：
- 氏名：${userInfo.actualName}
- 障害種別：${userInfo.disabilityType}
- 障害支援区分：${userInfo.disabilitySupportCategory}

面談記録：
${interviewText}

上記の情報を基に、JSON形式で以下の構造のモニタリング報告書を作成してください：
{
  "comprehensiveSupport": "総合的な援助の方針",
  "overallStatus": "全体の状況",
  "monitoringItems": [
    {
      "priority": 1,
      "supportGoal": "支援目標",
      "completionPeriod": "達成時期",
      "serviceStatus": "サービス提供状況",
      "userSatisfaction": "本人の感想・満足度",
      "goalAchievement": "支援目標の達成度",
      "currentIssues": "今後の課題・解決方法",
      "planChanges": {
        "serviceChange": false,
        "serviceContent": false,
        "planModification": false
      },
      "otherNotes": "その他留意事項"
    }
  ]
}`
  }
}

// AI APIを呼び出す関数（実装時にはOllamaやローカルLLMに接続）
export const generateDocumentWithAI = async (
  documentType: keyof typeof AI_PROMPTS,
  interviewText: string,
  userInfo: any
): Promise<any> => {
  const prompt = AI_PROMPTS[documentType]
  
  // 実際の実装では、ここでローカルAI（Ollamaなど）を呼び出す
  // 現在はモック実装
  console.log('AI生成中...', {
    systemPrompt: prompt.systemPrompt,
    userPrompt: prompt.userPrompt(interviewText, userInfo)
  })

  // モック応答（実際の実装では削除）
  await new Promise(resolve => setTimeout(resolve, 2000))
  
  return generateMockResponse(documentType, userInfo)
}

// モック応答生成（実際の実装では不要）
const generateMockResponse = (documentType: string, userInfo: any) => {
  switch (documentType) {
    case 'servicePlan':
      return {
        lifeGoals: `${userInfo.actualName}さんが自分らしく安心して生活できるよう支援し、地域社会への参加を促進したい`,
        comprehensiveSupport: '本人の意向を尊重し、段階的な支援により自立した生活の実現を目指す',
        longTermGoals: '1年後に就労継続支援事業での定期利用を通じて社会参加を果たす',
        shortTermGoals: '3か月後に生活リズムを整え、対人関係スキルを向上させる',
        services: [
          {
            priority: 1,
            issueToSolve: '日常生活リズムの改善',
            supportGoal: '規則正しい生活習慣の確立',
            completionPeriod: '3か月',
            serviceType: '生活介護',
            serviceDetails: '週3回、1日6時間の日中活動',
            providerName: '地域生活支援センター',
            userRole: '毎日の生活記録をつける',
            evaluationPeriod: '月1回',
            otherNotes: '体調管理と服薬管理に注意'
          }
        ]
      }

    case 'weeklySchedule':
      return {
        schedule: [
          {
            day: 'monday',
            timeSlots: [
              { startTime: '09:00', endTime: '15:00', activity: '生活介護サービス', isService: true }
            ]
          },
          {
            day: 'tuesday', 
            timeSlots: [
              { startTime: '10:00', endTime: '12:00', activity: '医療機関受診', isService: false }
            ]
          },
          {
            day: 'wednesday',
            timeSlots: [
              { startTime: '', endTime: '', activity: '', isService: false }
            ]
          },
          {
            day: 'thursday',
            timeSlots: [
              { startTime: '', endTime: '', activity: '', isService: false }
            ]
          },
          {
            day: 'friday',
            timeSlots: [
              { startTime: '', endTime: '', activity: '', isService: false }
            ]
          },
          {
            day: 'saturday',
            timeSlots: [
              { startTime: '', endTime: '', activity: '', isService: false }
            ]
          },
          {
            day: 'sunday',
            timeSlots: [
              { startTime: '', endTime: '', activity: '', isService: false }
            ]
          }
        ],
        weeklyServices: '月1回の相談支援、3か月に1回のモニタリング',
        lifeOverview: 'サービス利用により規則正しい生活リズムを構築し、段階的な社会参加を実現する'
      }

    case 'needsAssessment':
      return {
        intake: {
          expressedNeeds: `${userInfo.actualName}さんは「将来的に自立した生活を送りたい」「働く場所を見つけたい」「人とのコミュニケーションを上手になりたい」と希望を表明されている。家族からの支援を受けながらも、できるだけ自分のことは自分でやりたいという意向がある。`,
          counselorNotes: `${userInfo.disabilityType}（障害支援区分：${userInfo.disabilitySupportCategory}）。家族と同居。日常生活において部分的な支援が必要。医療機関での定期受診あり。これまでの福祉サービス利用経験は限定的。家族の介護負担軽減も課題となっている。`
        },
        assessment: {
          biological: `身体機能：${userInfo.disabilityType}による機能制限があるが、基本的な移動や身の回りのことは概ね自立している。服薬管理は家族による支援が必要。定期的な医療機関受診により健康状態は安定している。疲労しやすい傾向があり、活動量の調整が必要。`,
          psychological: `認知面では理解力があり、自分の意思を表現することができる。新しい環境や変化に対して不安を感じやすく、時間をかけた説明や段階的な導入が効果的。将来への希望を持っており、意欲的に取り組む姿勢が見られる。自己肯定感の向上が課題。`,
          social: `家族との関係は良好で、信頼関係が築けている。初対面の人とのコミュニケーションには時間がかかるが、慣れた相手とは適切な関係を維持できる。集団での活動には参加意欲があるものの、人数や環境によって疲労度が変わる。社会性の向上に向けた段階的な取り組みが有効。`,
          environment: `家族との同居により安定した生活環境が確保されている。住環境は障害に配慮した設備が一部整備済み。地域の社会資源については情報が限定的で、活用の余地がある。交通手段は主に家族による送迎に依存しており、公共交通機関の利用には課題がある。`,
          professionalAssessment: `医師からは「症状は安定しており、適切な環境と支援があれば社会参加は十分可能」との見解。これまでの支援者からは「本人のペースに合わせた段階的な支援が効果的」との評価。心理検査結果では認知機能に大きな問題はなく、適応能力の向上が期待される。`,
          supportIssues: `1. 生活リズムの安定化と体調管理の支援 2. 社会参加に向けた段階的な環境設定 3. コミュニケーション能力の向上支援 4. 家族の介護負担軽減 5. 地域資源の活用促進 6. 将来的な就労に向けた準備支援 7. 自己肯定感と自立意識の醸成`
        },
        planning: {
          supportMethods: `本人のペースを尊重した段階的な支援プログラムを実施。まずは生活介護サービスでの日中活動を通じて生活リズムを安定させ、集団活動への適応を図る。併せて相談支援を活用し、本人・家族の不安軽減と情報提供を行う。医療機関との連携を継続し、定期的なモニタリングを実施する。`
        },
        personSummary: `${userInfo.actualName}さんは向上心があり、支援者との信頼関係を築くことができる方です。自分のペースで着実に成長していく力を持っており、適切な環境と段階的な支援により、社会参加と自立に向けた歩みを進めることが期待されます。`
      }

    default:
      return null
  }
}